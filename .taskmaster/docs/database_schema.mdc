---
description: 
globs: 
alwaysApply: false
---
# Database Schema - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå

## Stack
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storage (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏ï‡∏ß‡πå)
- **ORM**: Prisma
- **Framework**: Next.js (Full Stack)

## Schema Overview

```prisma
// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ========================================
// User Profile (extends Supabase Auth)
// ========================================

model Profile {
  id          String   @id // matches auth.users.id
  firstName   String
  lastName    String
  phoneNumber String   @unique
  profileImage String? // Supabase Storage URL
  
  // Farm relationships (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
  ownedFarmId    String? @unique // ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á (‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°)
  memberOfFarmId String? // ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  ownedFarm      Farm?  @relation("FarmOwner", fields: [ownedFarmId], references: [id])
  memberOfFarm   Farm?  @relation("FarmMember", fields: [memberOfFarmId], references: [id])
  sentInvitations FarmInvitation[] @relation("InvitationSender")
  receivedInvitations FarmInvitation[] @relation("InvitationReceiver")
  
  @@map("profiles")
}

// ========================================
// Farm Management
// ========================================

model Farm {
  id       String @id @default(cuid())
  name     String
  province String
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á 1 ‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô (‡πÅ‡∏ï‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°)
  owner       Profile? @relation("FarmOwner")
  members     Profile[] @relation("FarmMember") 
  animals     Animal[]
  invitations FarmInvitation[]
  
  @@map("farms")
}

model FarmInvitation {
  id       String           @id @default(cuid())
  status   InvitationStatus @default(PENDING)
  message  String?
  
  sentAt     DateTime  @default(now())
  respondedAt DateTime?
  expiresAt   DateTime  @default(dbgenerated("NOW() + INTERVAL '7 days'"))
  
  // Relations
  senderId String
  sender   Profile   @relation("InvitationSender", fields: [senderId], references: [id], onDelete: Cascade)
  
  receiverId String
  receiver   Profile   @relation("InvitationReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  farmId String
  farm   Farm   @relation(fields: [farmId], references: [id], onDelete: Cascade)
  
  @@unique([receiverId, farmId])
  @@map("farm_invitations")
}

// ========================================
// Animal Management
// ========================================

model Animal {
  id         String    @id @default(cuid())
  name       String
  animalType String    // ‡∏´‡∏°‡∏π, ‡πÑ‡∏Å‡πà, ‡πÇ‡∏Ñ, ‡∏ß‡∏±‡∏ß, ‡∏Ñ‡∏ß‡∏≤‡∏¢, ‡πÑ‡∏Å‡πà‡∏ä‡∏ô, ‡πÄ‡∏õ‡πá‡∏î, ‡∏´‡πà‡∏≤‡∏ô, ‡πÑ‡∏Å‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠, ‡πÑ‡∏Å‡πà‡πÑ‡∏Ç‡πà
  microchip  String    @unique // auto-generated: TH{farmId}{timestamp}{random}
  birthDate  DateTime
  weight     Float?
  height     Float?
  color      String?
  fatherName String?
  motherName String?
  image      String?   // Supabase Storage URL
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  // Relations
  farmId String
  farm   Farm   @relation(fields: [farmId], references: [id], onDelete: Cascade)
  
  activities Activity[]
  schedules  ActivitySchedule[]
  
  @@map("animals")
}

// ========================================
// Activity Management
// ========================================

model Activity {
  id          String       @id @default(cuid())
  title       String
  description String?
  notes       String?
  activityDate DateTime
  status      ActivityStatus @default(COMPLETED)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  animalId String
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)
  
  // Optional: Link to scheduled activity
  scheduleId String?         @unique
  schedule   ActivitySchedule? @relation(fields: [scheduleId], references: [id])
  
  @@map("activities")
}

model ActivitySchedule {
  id          String             @id @default(cuid())
  title       String
  description String?
  notes       String?
  
  // Scheduling
  scheduledDate DateTime
  status        ScheduleStatus   @default(PENDING)
  
  // Recurrence (optional for future enhancement)
  isRecurring   Boolean @default(false)
  recurrenceType RecurrenceType?
  recurrenceInterval Int?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  completedAt   DateTime?
  
  // Relations
  animalId String
  animal   Animal @relation(fields: [animalId], references: [id], onDelete: Cascade)
  
  // When completed, this will link to the activity record
  completedActivity Activity?
  
  @@map("activity_schedules")
}

// ========================================
// Enums
// ========================================

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

enum ActivityStatus {
  COMPLETED
  CANCELLED
}

enum ScheduleStatus {
  PENDING
  COMPLETED
  CANCELLED
  OVERDUE
}

enum RecurrenceType {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}
```

## Supabase Auth Setup

```sql
-- Enable RLS on all tables
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE farms ENABLE ROW LEVEL SECURITY;
ALTER TABLE farm_invitations ENABLE ROW LEVEL SECURITY;
ALTER TABLE animals ENABLE ROW LEVEL SECURITY;
ALTER TABLE activities ENABLE ROW LEVEL SECURITY;
ALTER TABLE activity_schedules ENABLE ROW LEVEL SECURITY;

-- Create profiles table trigger to auto-create profile on signup
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, first_name, last_name, phone_number)
  VALUES (
    NEW.id,
    COALESCE(NEW.raw_user_meta_data->>'first_name', ''),
    COALESCE(NEW.raw_user_meta_data->>'last_name', ''),
    COALESCE(NEW.phone, '')
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

## Row Level Security Policies

```sql
-- Profiles policies
CREATE POLICY "Users can view all profiles" ON profiles
  FOR SELECT USING (true);

CREATE POLICY "Users can update own profile" ON profiles
  FOR UPDATE USING (auth.uid() = id);

-- Farms policies  
CREATE POLICY "Farm owners and members can view farms" ON farms
  FOR SELECT USING (
    -- ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.owned_farm_id = id AND p.id = auth.uid()
    ) OR
    -- ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p  
      WHERE p.member_of_farm_id = id AND p.id = auth.uid()
    )
  );

CREATE POLICY "Farm owners can update farms" ON farms
  FOR UPDATE USING (
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.owned_farm_id = id AND p.id = auth.uid()
    )
  );

CREATE POLICY "Users can create farms" ON farms
  FOR INSERT WITH CHECK (
    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô
    NOT EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.id = auth.uid() AND p.owned_farm_id IS NOT NULL
    )
  );

-- Animals policies
CREATE POLICY "Farm owners and members can view animals" ON animals
  FOR SELECT USING (
    -- ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.owned_farm_id = animals.farm_id AND p.id = auth.uid()
    ) OR
    -- ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.member_of_farm_id = animals.farm_id AND p.id = auth.uid()
    )
  );

CREATE POLICY "Farm owners and members can manage animals" ON animals
  FOR ALL USING (
    -- ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.owned_farm_id = animals.farm_id AND p.id = auth.uid()
    ) OR
    -- ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÑ‡∏î‡πâ
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.member_of_farm_id = animals.farm_id AND p.id = auth.uid()
    )
  );
```

## Supabase Storage Buckets

```sql
-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Storage Buckets
INSERT INTO storage.buckets (id, name, public) VALUES 
  ('user-profiles', 'user-profiles', true),
  ('animal-images', 'animal-images', true);

-- RLS Policies ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö user-profiles bucket
CREATE POLICY "Users can upload their own profile images" ON storage.objects
  FOR INSERT WITH CHECK (
    bucket_id = 'user-profiles' AND 
    auth.uid()::text = (storage.foldername(name))[1]
  );

CREATE POLICY "Users can view all profile images" ON storage.objects
  FOR SELECT USING (bucket_id = 'user-profiles');

CREATE POLICY "Users can update their own profile images" ON storage.objects
  FOR UPDATE USING (
    bucket_id = 'user-profiles' AND 
    auth.uid()::text = (storage.foldername(name))[1]
  );

-- RLS Policies ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö animal-images bucket
CREATE POLICY "Farm owners and members can upload animal images" ON storage.objects
  FOR INSERT WITH CHECK (
    bucket_id = 'animal-images' AND 
    EXISTS (
      SELECT 1 FROM profiles p
      JOIN animals a ON (a.farm_id = p.owned_farm_id OR a.farm_id = p.member_of_farm_id)
      WHERE p.id = auth.uid()::text
      AND a.id = (storage.foldername(name))[1]
    )
  );

CREATE POLICY "Farm owners and members can view animal images" ON storage.objects
  FOR SELECT USING (
    bucket_id = 'animal-images' AND 
    EXISTS (
      SELECT 1 FROM profiles p
      JOIN animals a ON (a.farm_id = p.owned_farm_id OR a.farm_id = p.member_of_farm_id)
      WHERE p.id = auth.uid()::text
      AND a.id = (storage.foldername(name))[1]
    )
  );
```

## Key Features Implementation

### 1. Authentication (Supabase Auth)
- **Phone + Password**: ‡πÉ‡∏ä‡πâ Supabase Auth ‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
- **Auto Profile Creation**: ‡∏™‡∏£‡πâ‡∏≤‡∏á profile ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ signup
- **RLS Security**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö row ‡∏î‡πâ‡∏ß‡∏¢ Supabase RLS
- **No API Routes**: ‡πÉ‡∏ä‡πâ Supabase client directly ‡πÉ‡∏ô Next.js

### 2. Farm Ownership & Membership  
- **One Farm Owner**: User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- **One Farm Member**: ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ 1 ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- **Simple Access Control**: ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ, ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
- **RLS Protected**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ RLS policies

### 3. Animal Management
- **Auto Microchip**: `TH{farmId}{timestamp}{random}` ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **Supabase Storage**: ‡∏£‡∏π‡∏õ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Supabase Storage
- **Buddhist Calendar**: ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏±‡∏Å‡∏£‡∏≤‡∏ä‡πÉ‡∏ô UI layer
- **Member Access**: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ

### 4. Activity System
**2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:**
1. **Activity** - ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥)
   - ‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏â‡∏µ‡∏î‡∏¢‡∏≤, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
2. **ActivitySchedule** - ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î)
   - ‡∏ô‡∏±‡∏î‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥

### 5. Farm Invitation System
- **Phone-based Invite**: ‡πÄ‡∏ä‡∏¥‡∏ç‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
- **User Validation**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏°‡∏µ Profile ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- **7-day Expiry**: ‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô
- **Response Required**: ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç

## Database Functions & Triggers

```sql
-- Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Microchip ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
CREATE OR REPLACE FUNCTION generate_microchip(farm_id text)
RETURNS text AS $$
DECLARE
  timestamp_part text;
  random_part text;
BEGIN
  timestamp_part := EXTRACT(EPOCH FROM NOW())::bigint::text;
  random_part := LPAD(FLOOR(RANDOM() * 10000)::text, 4, '0');
  RETURN 'TH' || farm_id || timestamp_part || random_part;
END;
$$ LANGUAGE plpgsql;

-- Trigger ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Microchip
CREATE OR REPLACE FUNCTION set_animal_microchip()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.microchip IS NULL OR NEW.microchip = '' THEN
    NEW.microchip := generate_microchip(NEW.farm_id);
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_set_animal_microchip
  BEFORE INSERT ON animals
  FOR EACH ROW
  EXECUTE FUNCTION set_animal_microchip();

-- Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Schedule Status
CREATE OR REPLACE FUNCTION update_schedule_status()
RETURNS void AS $$
BEGIN
  UPDATE activity_schedules 
  SET status = 'OVERDUE'
  WHERE status = 'PENDING' 
    AND scheduled_date < CURRENT_DATE;
END;
$$ LANGUAGE plpgsql;

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Cron Job ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ Overdue (‡∏ñ‡πâ‡∏≤ Supabase ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
-- SELECT cron.schedule('update-overdue-schedules', '0 1 * * *', 'SELECT update_schedule_status();');
```

## Indexes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Performance

```sql
-- Indexes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query performance
CREATE INDEX idx_profiles_phone_number ON profiles(phone_number);
CREATE INDEX idx_profiles_owned_farm_id ON profiles(owned_farm_id);
CREATE INDEX idx_profiles_member_of_farm_id ON profiles(member_of_farm_id);
CREATE INDEX idx_animals_farm_id ON animals(farm_id);
CREATE INDEX idx_activities_animal_id ON activities(animal_id);
CREATE INDEX idx_activity_schedules_animal_id ON activity_schedules(animal_id);
CREATE INDEX idx_activity_schedules_scheduled_date ON activity_schedules(scheduled_date);
CREATE INDEX idx_activity_schedules_status ON activity_schedules(status);
CREATE INDEX idx_farm_invitations_receiver_status ON farm_invitations(receiver_id, status);
CREATE INDEX idx_farm_invitations_sender_id ON farm_invitations(sender_id);
```

## Next.js + Supabase Setup

### Environment Variables (.env.local)
```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Database (for Prisma)
DATABASE_URL=postgresql://postgres:[password]@[host]:5432/postgres
DIRECT_URL=postgresql://postgres:[password]@[host]:5432/postgres
```

### Supabase Client Setup
```typescript
// lib/supabase.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!

export const supabase = createClient(supabaseUrl, supabaseKey)

// For client components
export const createClientComponentClient = () => 
  createClient(supabaseUrl, supabaseKey)

// For server components  
import { createServerComponentClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'

export const createServerClient = () => 
  createServerComponentClient({ cookies })
```

## Usage Examples (Next.js + Supabase)

### 1. Authentication (Phone + Password)
```typescript
// pages/api/auth/signup.ts ‡∏´‡∏£‡∏∑‡∏≠ app actions
import { supabase } from '@/lib/supabase'

export async function signUp(phone: string, password: string, metadata: any) {
  const { data, error } = await supabase.auth.signUp({
    phone: phone,
    password: password,
    options: {
      data: {
        first_name: metadata.firstName,
        last_name: metadata.lastName,
      }
    }
  })
  
  return { data, error }
}
```

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á (Server Action)
```typescript
// app/actions/farm.ts
'use server'
import { createServerClient } from '@/lib/supabase'
import { prisma } from '@/lib/prisma'

export async function createFarm(name: string, province: string) {
  const supabase = createServerClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) throw new Error('Not authenticated')
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô
  const existingProfile = await prisma.profile.findUnique({
    where: { id: user.id }
  })
  
  if (existingProfile?.ownedFarmId) {
    throw new Error('‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
  }
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï profile
  const farm = await prisma.farm.create({
    data: { name, province }
  })
  
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï profile ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ
  await prisma.profile.update({
    where: { id: user.id },
    data: { ownedFarmId: farm.id }
  })
  
  return farm
}
```

### 3. ‡πÄ‡∏ä‡∏¥‡∏ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏° (Client Component)
```typescript
// components/InviteMember.tsx
'use client'
import { useSupabase } from '@/hooks/useSupabase'

export function InviteMember({ farmId }: { farmId: string }) {
  const { supabase, user } = useSupabase()
  
  const inviteMember = async (phoneNumber: string) => {
    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ profile ‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
    const { data: profile } = await supabase
      .from('profiles')
      .select('id, owned_farm_id, member_of_farm_id')
      .eq('phone_number', phoneNumber)
      .single()
    
    if (!profile) {
      throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö')
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏ô‡∏±‡πâ‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô
    if (profile.member_of_farm_id) {
      throw new Error('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô
    if (profile.owned_farm_id) {
      throw new Error('‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
    }
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç
    const { error } = await supabase
      .from('farm_invitations')
      .insert({
        sender_id: user?.id,
        receiver_id: profile.id,
        farm_id: farmId,
        message: '‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°'
      })
    
    if (error) throw error
  }
  
  return (
    // UI component here
  )
}
```

### 4. ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏° (Server Action)
```typescript
// app/actions/invitation.ts
'use server'
import { createServerClient } from '@/lib/supabase'
import { prisma } from '@/lib/prisma'

export async function acceptInvitation(invitationId: string) {
  const supabase = createServerClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) throw new Error('Not authenticated')
  
  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç
  const invitation = await prisma.farmInvitation.findUnique({
    where: { id: invitationId },
    include: { farm: true }
  })
  
  if (!invitation || invitation.receiverId !== user.id) {
    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå')
  }
  
  if (invitation.status !== 'PENDING') {
    throw new Error('‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß')
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô
  const profile = await prisma.profile.findUnique({
    where: { id: user.id }
  })
  
  if (profile?.memberOfFarmId || profile?.ownedFarmId) {
    throw new Error('‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß')
  }
  
  // ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç
  await prisma.$transaction([
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç
    prisma.farmInvitation.update({
      where: { id: invitationId },
      data: { 
        status: 'ACCEPTED',
        respondedAt: new Date()
      }
    }),
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï profile ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°
    prisma.profile.update({
      where: { id: user.id },
      data: { memberOfFarmId: invitation.farmId }
    })
  ])
  
  return invitation.farm
}
```

### 5. ‡∏î‡∏∂‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Server Component)
```typescript
// app/profile/page.tsx
import { createServerClient } from '@/lib/supabase'
import { prisma } from '@/lib/prisma'

export default async function ProfilePage() {
  const supabase = createServerClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) return <div>Please login</div>
  
  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• profile ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
  const profile = await prisma.profile.findUnique({
    where: { id: user.id },
    include: {
      ownedFarm: true,
      memberOfFarm: true,
      receivedInvitations: {
        where: { status: 'PENDING' },
        include: { 
          farm: true,
          sender: true 
        }
      }
    }
  })
  
  return (
    <div>
      {/* ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á */}
      {profile?.ownedFarm && (
        <div>
          <h2>‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</h2>
          <p>{profile.ownedFarm.name}</p>
        </div>
      )}
      
      {/* ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å */}
      {profile?.memberOfFarm && (
        <div>
          <h2>‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
          <p>{profile.memberOfFarm.name}</p>
        </div>
      )}
      
      {/* ‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö */}
      {profile?.receivedInvitations.map(invitation => (
        <div key={invitation.id}>
          <p>‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏à‡∏≤‡∏Å {invitation.sender.firstName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏° {invitation.farm.name}</p>
          {/* Accept/Decline buttons */}
        </div>
      ))}
    </div>
  )
}
```

### 6. ‡∏î‡∏∂‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î (Server Component)
```typescript
// app/dashboard/[farmId]/page.tsx
import { createServerClient } from '@/lib/supabase'
import { prisma } from '@/lib/prisma'

export default async function DashboardPage({ 
  params 
}: { 
  params: { farmId: string } 
}) {
  const supabase = createServerClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  // ‡∏î‡∏∂‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î (RLS ‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
  const overdueActivities = await prisma.activitySchedule.findMany({
    where: {
      status: "PENDING",
      scheduledDate: {
        lte: new Date()
      },
      animal: {
        farmId: params.farmId
      }
    },
    include: {
      animal: {
        select: {
          id: true,
          name: true,
          animalType: true
        }
      }
    }
  })
  
  return (
    <div>
      {/* Render overdue activities */}
    </div>
  )
}
```

### 5. Real-time Updates (Client Component)
```typescript
// hooks/useRealtimeActivities.ts
'use client'
import { useEffect, useState } from 'react'
import { useSupabase } from '@/hooks/useSupabase'

export function useRealtimeActivities(farmId: string) {
  const { supabase } = useSupabase()
  const [activities, setActivities] = useState([])
  
  useEffect(() => {
    // Subscribe to real-time changes
    const channel = supabase
      .channel('activity_schedules')
      .on('postgres_changes', {
        event: '*',
        schema: 'public',
        table: 'activity_schedules',
        filter: `animal.farm_id=eq.${farmId}`
      }, (payload) => {
        // Handle real-time updates
        console.log('Activity updated:', payload)
      })
      .subscribe()
    
    return () => {
      supabase.removeChannel(channel)
    }
  }, [farmId])
  
  return activities
}
```

## Security Considerations

1. **Supabase RLS (Row Level Security)** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö row ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
2. **Supabase Auth** - JWT-based authentication, password hashing ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
3. **Storage Security** - RLS policies ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
4. **Input Validation** - ‡πÉ‡∏ä‡πâ Zod ‡∏´‡∏£‡∏∑‡∏≠ Yup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö validation ‡πÉ‡∏ô Next.js
5. **Environment Variables** - ‡πÄ‡∏Å‡πá‡∏ö API keys ‡πÉ‡∏ô .env.local
6. **CORS Protection** - Supabase ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ CORS ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
7. **Rate Limiting** - ‡πÉ‡∏ä‡πâ Supabase built-in rate limiting

## Migration Strategy (Next.js + Supabase)

### Phase 1: Database Setup
```bash
# 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies
npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
npm install prisma @prisma/client
npm install @types/node typescript tsx

# 2. Setup Prisma
npx prisma init
# Copy schema.prisma content
npx prisma generate
npx prisma db push
```

### Phase 2: Supabase Configuration
```sql
-- 3. Enable RLS ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á policies (‡πÉ‡∏ô Supabase SQL Editor)
-- Copy all RLS policies from above

-- 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á storage buckets
-- Copy storage setup from above

-- 5. ‡∏™‡∏£‡πâ‡∏≤‡∏á functions ‡πÅ‡∏•‡∏∞ triggers
-- Copy database functions from above

-- 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á indexes
-- Copy indexes from above
```

### Phase 3: Next.js Integration
```typescript
// 7. Setup Supabase clients
// lib/supabase.ts - Copy client setup from above

// 8. Create auth context
// contexts/AuthContext.tsx

// 9. Setup middleware for auth
// middleware.ts
```

### Phase 4: Testing & Seed Data
```typescript
// 10. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
// scripts/seed.ts
const testUsers = [
  { phone: '0929931147', firstName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', lastName: '‡πÉ‡∏à‡∏î‡∏µ' },
  { phone: '0812345678', firstName: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á', lastName: '‡∏£‡∏±‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå' }
]

// 11. Test authentication flow
// 12. Test RLS policies
// 13. Test file uploads
```

## Package.json Dependencies

```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.x.x",
    "@supabase/auth-helpers-nextjs": "^0.x.x",
    "@prisma/client": "^5.x.x",
    "next": "^14.x.x",
    "react": "^18.x.x",
    "typescript": "^5.x.x"
  },
  "devDependencies": {
    "prisma": "^5.x.x",
    "@types/node": "^20.x.x",
    "tsx": "^4.x.x"
  }
}
```

## ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á Architecture ‡∏ô‡∏µ‡πâ

‚úÖ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á API routes** - ‡πÉ‡∏ä‡πâ Supabase client ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
‚úÖ **Real-time ‡πÇ‡∏î‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥** - Supabase real-time subscriptions
‚úÖ **Authentication ‡∏á‡πà‡∏≤‡∏¢** - Supabase Auth ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î
‚úÖ **Security ‡πÅ‡∏ô‡πà‡∏ô** - RLS ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
‚úÖ **Scalable** - Supabase ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö load ‡∏™‡∏π‡∏á
‚úÖ **Type-safe** - Prisma + TypeScript
‚úÖ **‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠ Deploy** - Vercel + Supabase

Schema ‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Full Stack Next.js + Supabase** ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å feature ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á! üöÄ
